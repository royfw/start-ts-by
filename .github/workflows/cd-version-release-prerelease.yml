name: Version (prerelease branches)

on:
  pull_request_target:
    branches:
      - release/alpha
      - release/beta
      - release/rc
    types: [closed]

permissions:
  contents: write
  pull-requests: write

jobs:
  resolve:
    runs-on: ubuntu-latest
    outputs:
      channel: ${{ steps.ch.outputs.channel }}
    if: github.event.pull_request.merged == true
    steps:
      - id: ch
        run: |
          REF="${{ github.event.pull_request.base.ref }}"
          echo "channel=${REF#release/}" >> "$GITHUB_OUTPUT"

  version:
    needs: resolve
    uses: royfw/rf-devops/.github/workflows/_changesets-version-channel.yml@main
    secrets:
      GIT_TOKEN: ${{ secrets.GIT_TOKEN }}
    with:
      ref: ${{ github.event.pull_request.base.ref }}
      channel: ${{ needs.resolve.outputs.channel }}
